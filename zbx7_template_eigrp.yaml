zabbix_export:
  version: '7.0'
  template_groups:
    - uuid: 57b7ae836ca64446ba2c296389c009b7
      name: Templates/Modules
  templates:
    - uuid: 4762b4e2f99747c7be2792d06ea77e26
      template: 'Cisco EIGRP by SNMP'
      name: 'Cisco EIGRP by SNMP'
      description: |
        Шаблон для мониторинга состояния соседей Cisco EIGRP  
        
        MIBs used:
        CISCO-EIGRP-MIB
      groups:
        - name: Templates/Modules
      discovery_rules:
        - uuid: 59eb167c9c3a4a428ad23d62b16aa8c5
          name: 'EIGRP Discovery'
          type: SNMP_AGENT
          snmp_oid: 'walk[1.3.6.1.4.1.9.9.449.1.4.1.1.3]'
          key: eigrp.neighbors.discovery
          delay: 15m
          filter:
            evaltype: AND
            conditions:
              - macro: '{#NEIGHBOR_IP}'
                value: '{$NET.EIGRP.NEIGHBOR.IP.MATCHES}'
                formulaid: A
              - macro: '{#NEIGHBOR_IP}'
                value: '{$NET.EIGRP.NEIGHBOR.IP.NOT_MATCHES}'
                operator: NOT_MATCHES_REGEX
                formulaid: B
          lifetime: 30d
          enabled_lifetime_type: DISABLE_NEVER
          description: 'Обнаружение EIGRP соседей.'
          item_prototypes:
            - uuid: 7331b75893b04a58aa4f952172b53995
              name: 'EIGRP neighbor [{#NEIGHBOR_IP}] RTO'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.4.1.9.9.449.1.4.1.1.8["index","1.3.6.1.4.1.9.9.449.1.4.1.1.3","{#NEIGHBOR_HEX_IP}"]'
              key: 'eigrp.neighbor.rto[{#NEIGHBOR_IP}]'
              value_type: FLOAT
              units: s
              description: 'Retransmission timeout (RTO) — интервал между отправкой unicast-пакетов. Вычисляется на основании SRTT.'
              preprocessing:
                - type: MULTIPLIER
                  parameters:
                    - '0.001'
              tags:
                - tag: component
                  value: network
                - tag: neighbor
                  value: '{#NEIGHBOR_IP}'
              trigger_prototypes:
                - uuid: fef5560cc9cb45cfafc66698a5fc7eaf
                  expression: |
                    last(/Cisco EIGRP by SNMP/eigrp.neighbor.rto[{#NEIGHBOR_IP}])=5
                    and
                    last(/Cisco EIGRP by SNMP/eigrp.neighbor.rto[{#NEIGHBOR_IP}],#2)=5
                  name: 'RTO=5000 EIGRP-соседа {#NEIGHBOR_IP}'
                  opdata: 'Текущее значение:{ITEM.LASTVALUE1}'
                  priority: INFO
                  description: 'Retransmission timeout (время ожидания повторной передачи) EIGRP-соседа = 5000мс.'
                  manual_close: 'YES'
                  dependencies:
                    - name: 'Нет EIGRP-соседа {#NEIGHBOR_IP}'
                      expression: 'nodata(/Cisco EIGRP by SNMP/eigrp.neighbor.srtt[{#NEIGHBOR_IP}],600)=1'
                  tags:
                    - tag: scope
                      value: perfomance
            - uuid: 1e9db776426a4072bea774fac2445163
              name: 'EIGRP neighbor [{#NEIGHBOR_IP}] SRTT'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.4.1.9.9.449.1.4.1.1.7["index","1.3.6.1.4.1.9.9.449.1.4.1.1.3","{#NEIGHBOR_HEX_IP}"]'
              key: 'eigrp.neighbor.srtt[{#NEIGHBOR_IP}]'
              value_type: FLOAT
              units: s
              description: 'Smooth round-trip time (SRTT) — время между отправкой пакета соседу и получением подтверждения от него. Измеряется в миллисекундах.'
              preprocessing:
                - type: MULTIPLIER
                  parameters:
                    - '0.001'
              tags:
                - tag: component
                  value: network
                - tag: neighbor
                  value: '{#NEIGHBOR_IP}'
              trigger_prototypes:
                - uuid: 744e7521f3d94c509fdf5718d2676cb1
                  expression: 'last(/Cisco EIGRP by SNMP/eigrp.neighbor.srtt[{#NEIGHBOR_IP}])>{$EIGRP_SRTT_WARN}'
                  name: 'Большое время SRTT EIGRP-соседа {#NEIGHBOR_IP}'
                  opdata: 'Текущее значение:{ITEM.LASTVALUE1}'
                  priority: INFO
                  description: 'Smooth round-trip time (время плавного кругового прохождения) EIGRP-соседа превысило допустимое значение {$EIGRP_SRTT_WARN}с.'
                  manual_close: 'YES'
                  dependencies:
                    - name: 'RTO=5000 EIGRP-соседа {#NEIGHBOR_IP}'
                      expression: |
                        last(/Cisco EIGRP by SNMP/eigrp.neighbor.rto[{#NEIGHBOR_IP}])=5
                        and
                        last(/Cisco EIGRP by SNMP/eigrp.neighbor.rto[{#NEIGHBOR_IP}],#2)=5
                    - name: 'Нет EIGRP-соседа {#NEIGHBOR_IP}'
                      expression: 'nodata(/Cisco EIGRP by SNMP/eigrp.neighbor.srtt[{#NEIGHBOR_IP}],600)=1'
                  tags:
                    - tag: scope
                      value: perfomance
                - uuid: c6b9e747023b4a60acec431a9cba78f6
                  expression: 'nodata(/Cisco EIGRP by SNMP/eigrp.neighbor.srtt[{#NEIGHBOR_IP}],600)=1'
                  name: 'Нет EIGRP-соседа {#NEIGHBOR_IP}'
                  priority: INFO
                  description: 'В течение 10-ти минут не найден EIGRP-сосед.'
                  manual_close: 'YES'
                  tags:
                    - tag: scope
                      value: availability
          graph_prototypes:
            - uuid: 322bb4f583654b4db8affa5649478ba8
              name: 'EIGRP neighbor [{#NEIGHBOR_IP}] SRTT'
              graph_items:
                - sortorder: '1'
                  color: 9C27B0
                  item:
                    host: 'Cisco EIGRP by SNMP'
                    key: 'eigrp.neighbor.srtt[{#NEIGHBOR_IP}]'
          preprocessing:
            - type: SNMP_WALK_TO_JSON
              parameters:
                - '{#NEIGHBOR_HEX_IP}'
                - 1.3.6.1.4.1.9.9.449.1.4.1.1.3
                - '0'
                - '{#NEIGHBOR_IP}'
                - 1.3.6.1.4.1.9.9.449.1.4.1.1.3
                - '0'
            - type: JAVASCRIPT
              parameters:
                - |
                  var dict = JSON.parse(value);
                  for (key in dict) {
                    dict[key]["{#NEIGHBOR_IP}"] = dict[key]["{#NEIGHBOR_IP}"].trim().split(" ").map(function(oktet){return parseInt(oktet,16)}).join(".");
                    dict[key]["{#NEIGHBOR_HEX_IP}"] = dict[key]["{#NEIGHBOR_HEX_IP}"].trim() + " ";
                  }
                  return JSON.stringify(dict);
      tags:
        - tag: class
          value: network
        - tag: target
          value: cisco
        - tag: target
          value: eigrp
      macros:
        - macro: '{$EIGRP_SRTT_WARN}'
          value: '0.05'
          description: 'Предупреждение превышения плавной круговой задержки.'
        - macro: '{$NET.EIGRP.NEIGHBOR.IP.MATCHES}'
          value: '.*'
          description: 'Этот макрос-regexp используется для обнаружения EIGRP-соседей по ip-адресам.'
        - macro: '{$NET.EIGRP.NEIGHBOR.IP.NOT_MATCHES}'
          value: CHANGE_IF_NEEDED
          description: 'Этот макрос-regexp используется для исключения обнаружения EIGRP-соседей по ip-адресам.'
      dashboards:
        - uuid: 23ad285e0d444843a8d95380f7b20dc3
          name: 'EIGRP neighbors'
          pages:
            - widgets:
                - type: graphprototype
                  name: SRTT
                  width: '72'
                  height: '12'
                  fields:
                    - type: GRAPH_PROTOTYPE
                      name: graphid.0
                      value:
                        host: 'Cisco EIGRP by SNMP'
                        name: 'EIGRP neighbor [{#NEIGHBOR_IP}] SRTT'
                    - type: STRING
                      name: reference
                      value: AAAAA
                    - type: INTEGER
                      name: rows
                      value: '3'
